<div id="editJoint">
  <div class="scroll-container">
    <div id="body" [class.disabled-panel]="getJointLockState()">
      <!-- JOINT PANEL HEADER -->
      <panel-section-collapsible>
        <!-- Title block with inline editing, edit and delete buttons -->
        <title-block
          description=""
          class="editHeader"
          (click)="onTitleBlockClick($event)"
          >Edit Joint
          <ng-container *ngIf="isEditingTitle; else jointNameDisplay">
            <input
              #jointNameInput
              [(ngModel)]="getCurrentJoint().name"
              (blur)="setJointName(jointNameInput.value)"
              (keyup.enter)="setJointName(jointNameInput.value)"
            />
          </ng-container>
          <ng-template #jointNameDisplay>
            {{ getJointName() }}
          </ng-template>
          <!-- Edit button -->
          <button (click)="isEditingTitle = true">
            <img
              ngSrc="assets/icons/edit.svg"
              style="height: 16px; width: 16px"
              alt=""
              height="48"
              width="48"
            />
          </button>
          <!-- Delete button -->
          <button (click)="deleteJoint()">
            <img
              ngSrc="assets/icons/trash.svg"
              style="height: 16px; width: 16px"
              alt=""
              height="18"
              width="15"
            />
          </button>
        </title-block>
        <p class="subtitle">
          This is where you edit joints. Change things such as the position.
        </p>
      </panel-section-collapsible>

        <!-- BASIC SETTING DROPDOWN -->
        <collapsible-subsection
          titleLabel="Basic Settings"
          [expanded]="graphExpanded['basicBasic']"
          (opened)="graphExpanded['basicBasic'] = true"
          (closed)="graphExpanded['basicBasic'] = false"
          >
          <div id="jointPositions" class="xy-block">
            <label class="xy-label" style ="margin-left: 3px; margin-bottom: 6px;margin-top: 5px">Input X and Y positions</label>
            <div class="xy-row">
              <!-- X position input -->
              <div class="xy-cell">
                 <label style="margin-right: 5px;">X</label>
                <input
                  type="number"
                  [value]="pendingX ?? getJointXCoord()"
                  (input)="pendingX = $any($event.target).valueAsNumber"
                  (keydown.enter)="confirmJointX()"
                  [disabled]="getJointLockState()"
                />
                <span class="xy-unit">{{ units }}</span>
              </div>

            <!-- Y position input -->
            <div class="xy-cell">
               <label style="margin-right: 5px;">Y</label>
              <input
                type="number"
                [value]="pendingY ?? getJointYCoord()"
                (input)="pendingY = $any($event.target).valueAsNumber"
                (keydown.enter)="confirmJointY()"
                [disabled]="getJointLockState()"
              />
              <span class="xy-unit">{{ units }}</span>
            </div>
          </div>
          <div class="xy-row" *ngIf="currentJointType === 'slider' || currentJointType === 'slider-input'" style="margin-top: 16px;">
            <div class="xy-cell">
              <label style="margin-right: 5px;">Angle</label>
              <input
                type="number"
                [value]="pendingAngle ?? getJointAngle2()"
                (input)="pendingAngle = $any($event.target).valueAsNumber"
                (keydown.enter)="confirmJointAngle()"
                [disabled]="getJointLockState()"
              />
              <span class="xy-unit">deg</span>
            </div>
          </div>
        </div>

        <div id="inputJointSpeed" class="speed-block">
          <label class="speed-label" style ="margin-left: 3px; margin-bottom: 6px;margin-top: 5px">
            Input Speed and Direction
            <mat-icon
              class="label-help"
              matTooltip="CW = Clockwise, CCW = Counterclockwise"
              [matTooltipShowDelay]="600"
            >help_outline</mat-icon>

          </label>
          <div class="speed-row">
            <!-- changes input joint speed in rpm -->
            <div class="speed-cell">
              <input
                type="number"
                [value]="getInputSpeed()"
                (input)="setInputSpeed($any($event.target).valueAsNumber)"
                [disabled]="getJointLockState()"
              />
              <span class="speed-unit">rpm</span>
            </div>


              <div class="speed-cell">

                <!-- Clockwise -->
                <button
                  type="button"
                  class="dir-btn"
                  [class.selected]="!animationService.startDirectionCounterclockwise"
                  [disabled]="getJointLockState()"
                  (click)="onDirectionChanged('Clockwise')"
                  matTooltip="Clockwise"
                  [matTooltipShowDelay]="600"
                >CW</button>


                <!-- Counterclockwise -->
                <button
                  type="button"
                  class="dir-btn"
                  [class.selected]="animationService.startDirectionCounterclockwise"
                  [disabled]="getJointLockState()"
                  (click)="onDirectionChanged('Counterclockwise')"
                  matTooltip="Counterclockwise"
                  [matTooltipShowDelay]="600"
                >CCW</button>

              </div>
            </div>
        </div>





      </collapsible-subsection>

      <!-- DYNAMICALLY DISPLAYS CONNECTED JOINTS BASED ON A LIST PROVIDED IN THE TYPESCRIPT -->
      <collapsible-subsection
        titleLabel="Distance to Joint"
        [expanded]="graphExpanded['distance']"
        (opened)="graphExpanded['distance'] = true"
        (closed)="graphExpanded['distance'] = false"
      >
        <div id="connectedJoints">
          <div id="container">
            <div *ngFor="let joint of getConnectedJoints()">
              <ng-container *ngIf="getCurrentJoint().name !== joint.name">
                <div class="distance-angle-block">
                  <!-- LABEL -->
                  <div class="dar-label">
                    Joint {{ getCurrentJoint().name }} to Joint {{ joint.name }}
                  </div>

                  <!-- Then the row of inputs -->
                  <div class="distance-angle-row">
                    <div class="dar-cell">
                      <!-- distance input -->
                      <img
                        ngSrc="assets/icons/length.svg"
                        class="dar-icon"
                        height="15"
                        width="12"
                        alt=""
                        style = "margin-right: 5px"
                      />
                      <input
                        type="number"
                        id="angleInputElement"
                        [value]="pendingJointDistance ?? getJointDistance(joint)"
                        (input)="
                          pendingJointDistance = $any($event.target).valueAsNumber
                        "
                        (keydown.enter)="
                          changeJointDistance(
                            joint.id,
                            $any($event.target).valueAsNumber
                          )
                        "
                        (mouseenter)="onLengthHover(true, joint.id)"
                        (mouseleave)="onLengthHover(false, joint.id)"
                        (focus)="onLengthHover(true, joint.id)"
                        (blur)="onLengthHover(false, joint.id)"
                        [disabled]="joint.locked"
                      />
                      <span class="dar-unit">{{ units }}</span>
                    </div>

                    <div class="dar-cell">
                      <!-- angle input -->
                      <img
                        ngSrc="assets/icons/angle.svg"
                        class="dar-icon"
                        height="10"
                        width="10"
                        alt=""
                      />
                      <input
                        type="number"
                        [ngModel]="pendingJointAngle ?? getJointAngle(joint)"
                        (input) = "pendingJointAngle = $any($event.target).valueAsNumber"
                        (keydown.enter)="
                          onAngleEnter(joint.id, $any($event.target).value)
                        "
                        (mouseenter)="onAngleHover(true, joint.id)"
                        (mouseleave)="onAngleHover(false, joint.id)"
                        (focus)="onAngleHover(true, joint.id)"
                        (blur)="onAngleHover(false, joint.id)"
                        [disabled]="joint.locked"
                      />
                      <span class="dar-unit">{{ angles }}</span>
                    </div>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
      </collapsible-subsection>

      <!-- ADVANCED SETTING DROPDOWN -->
      <collapsible-subsection
        titleLabel="Advanced Settings"
        [expanded]="
          graphExpanded['advancedSettingsBasic'] ||
          this.getCurrentJoint().locked
        "
        (opened)="graphExpanded['advancedSettingsBasic'] = true"
        (closed)="graphExpanded['advancedSettingsBasic'] = false"
      >
        <!-- TOGGLE BLOCK FOR GROUNDING -->
        <app-toggle
          tooltip="This toggle will ground or remove the ground on the joint"
          label="Add Ground"
          [initialValue]="_isGround"
          [iconClass]="'toggle-ground-icon'"
          [disabled] = "_preventForAni"
          (valueChanged)="handleToggleGroundChange($event)"
          (actionPrevented) = "toggleClickStopped($event)"
        ></app-toggle>
        <!-- TOGGLE BLOCK FOR WELDING -->
        <app-toggle
          *ngIf="canAddWeld()"
          tooltip="This toggle will weld or unweld the joint"
          label="Add Weld"
          [initialValue]="_isWeld"
          [iconClass]="'toggle-weld-icon'"
          [disabled] = "_preventForAni"
          (valueChanged)="handleToggleWeldChange($event)"
          (actionPrevented) = "toggleClickStopped($event)"
        ></app-toggle>
        <!-- TOGGLE BLOCK FOR INPUT -->
        <app-toggle
          *ngIf="canAddInput()"
          tooltip="This toggle will make the joint an input or remove the input"
          label="Add Input"
          [initialValue]="_isInput"
          [iconClass]="'toggle-input-icon'"
          [disabled] = "_preventForInput || _preventForAni"
          [canBeInput] = "_canBeInput"
          [inputToggle] = "true"
          (valueChanged)="handleToggleInputChange($event)"
          (actionPrevented) = "toggleClickStopped($event)"
        ></app-toggle>
      </collapsible-subsection>
    </div>
  </div>
</div>
